<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://opensemanticsearch.org/trigger/filemonitoring/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Filesystem monitoring - Open Semantic Search</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Filesystem monitoring";
        var mkdocs_page_input_path = "trigger/filemonitoring/README.md";
        var mkdocs_page_url = "/trigger/filemonitoring/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Open Semantic Search
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/search/">Search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/search/operators/">Search operators</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../doc/search/#overview-and-exploration-with-facets">Interactive filters (Faceted search)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/search/fuzzy/">Fuzzy search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/datamanagement/annotation/">Tagging and annotation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Structuring data and documents (Metadata management)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../doc/datamanagement/thesaurus/">Vocabulary and thesaurus (dictionary of names or concepts)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../doc/datamanagement/ontologies/">Lists, Dictionaries, Vocabularies and Thesauri (Ontologies)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Analyze and explore (Analytics)</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../investigative_journalism/howto-analyze-leaks/">Investigate massive leaks for investigative reporting</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../doc/analytics/law/">Legal codes and law clauses</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/search/list/">Search by list of names (batch searches)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Administration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/tutorial/">Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/admin/install/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/admin/config/">Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/admin/queue/">Task queue</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../doc/admin/config/log/">Logs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Additional Applications</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="/solr-search-csv-python-django/README.md">CSV Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/graph-explorer/README.md">Graph Explorer</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/lexememes/README.md">Lexememes</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/solr-ontology-tagger/README.md">Ontology Tagger</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/solr-relevance-ranking-analysis/README.md">Relevance Ranking Analysis</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/rdf2ocr/README.md">RDF or SKOS to OCR</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/rss-feed-manager-python-django/README.md">RSS-Feed Manager</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/search-list/README.md">Search Lists</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/skos2solr/README.md">SKOS to Solr</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/solr/README.md">Solr Server</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/tagger/README.md">Tagger</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="/solr-search-querytagger-python-django/README.md">QueryTagger</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../download/">Download</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="https://github.com/opensemanticsearch/open-semantic-search/">Development</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../donate/README.md">Donate</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Open Semantic Search</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Filesystem monitoring</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/opensemanticsearch/open-semantic-search/edit/master/docs/trigger/filemonitoring/README.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="filesystem-monitoring">Filesystem monitoring</h1>
<h2 id="reindex-new-or-changed-files-within-seconds-and-find-new-or-changed-content-in-document-files-much-earlier">(Re)index new or changed files within seconds and find new or changed content in document files much earlier</h2>
<p>Despite some <a href="#limitations">limitations</a> and after a first <a href="#limitations">initialization time of the file monitoring tools on start</a>, monitoring files and directories is a fast and efficient method to hold up to date the search index for your files or fileshare:</p>
<p>Instead of (re)crawling all directories and checking each file if new or changed, the operating system notifies the filemonitoring service when a file was changed or added.</p>
<p>So changed documents or new files can be indexed and found within seconds and without recrawl often, since frequent recrawls would burn many resources and can take a while, if there are tens of thousands of files, hundreds of thousands of files or even more.</p>
<h2 id="commandline-tool-cli">Commandline tool (CLI)</h2>
<p>(Package: <em>opensemanticsearch-trigger-filemonitoring</em>)</p>
<p>Monitor path(s) given as command line parameter:
<code>opensemanticsearch-filemonitoring *pathname*</code></p>
<p>Monitor all files and directories listed in <em>configfilename</em>:
<code>opensemanticsearch-filemonitoring --fromfile *configfilename*</code>
containing one directory or file per line.</p>
<h2 id="automatically-starting-system-service-daemon">Automatically starting system service (Daemon)</h2>
<p>(Package: <em>opensemanticsearch-trigger-filemonitoring-daemon</em>)</p>
<p>The daemon runs in the background as a system service and will start automatically while booting.</p>
<h3 id="directories-and-files-to-monitor">Directories and files to monitor</h3>
<p>It monitors the paths and files listed in the config file (one directory or file per line)
<em><code>/etc/opensemanticsearch/filemonitoring/files</code></em></p>
<h3 id="restart-daemon-after-config-changes">Restart daemon after config changes</h3>
<p>After config changes (i.e. adding new paths or filenames which are not subpaths of yet monitored paths) restart it with:
<code>systemctl restart opensemanticetl-filemonitoring</code></p>
<h2 id="file-monitoring-on-remote-fileserver">File monitoring on remote fileserver</h2>
<p>(Package: <em>opensemanticsearch-trigger-filemonitoring-daemon-remote</em>)</p>
<p>The file monitoring daemon is available as a lightweight remote package for remote fileservers, which only calls the search API of the remote search server.</p>
<h3 id="directories-and-files-to-monitor_1">Directories and files to monitor</h3>
<p>List the directories or files you want to monitor into the config file
<code>/etc/opensemanticsearch/filemonitoring/files</code>
containing one directory or file per line.</p>
<h3 id="config-remote-api-address">Config remote API address</h3>
<p>Change the IP address of your search servers and the URL of its API in the config file <code>/etc/opensemanticsearch/filemonitoring/config</code>:</p>
<p><code>config['api'] = "http://192.168.1.1/search-apps/api"</code></p>
<h3 id="blacklisting">Blacklisting</h3>
<p>Like on the search server (later in the indexing process), the remote filemonitoring daemon supports <a href="../../doc/admin/config/blacklist">blacklisting</a> too, so there is no network load to API because of changed files in blacklisted directories, blacklisted filename patterns or blacklisted file endings.</p>
<h2 id="limitations">Limitations</h2>
<p>Even if filesystem monitoring needs much fewer resources than frequent recrawls, you should be aware of some limitations:</p>
<h3 id="inotify-config">Inotify config</h3>
<p>You have to increase the kernel parameter
<code>fs.inotify.max_user_watches</code>
to a size fitting your count of monitored directories and files.</p>
<p>Well prepare an easy to change conig file for that in the next version.</p>
<h3 id="initialization-time">Initialization time</h3>
<p>On start the filemonitor has to walk recursivly trough all monitored directories and subdirectories to set up an inotify monitoring for this directories.</p>
<p>This can take a while: The initialization time can need some minutes to even some dozens of minutes, if the fileserver has hundred thousands of directories.</p>
<p>There will be some CPU load and high IO load on the harddrives while initialization. But after this initial directories scan and monitoring setup, it needs much fewer resources than recrawls.</p>
<p>While this initialization time not all directories are scanned and so not initialized for monitoring yet, so the file monitoring can not trigger (re)indexing of new or changed files.</p>
<h3 id="passed-filesystem-changes">Passed filesystem changes</h3>
<p>So while initialization time after boot or restart of the filemonitoring service and because sometimes the system can by so busy, that the file monitoring can pass some notify events for file changes, you should do from time to time an classic recrawl. This can run at night or on weekend and be started automatically by the Cron service.</p>
<h2 id="used-methods-and-libraries">Used methods and libraries</h2>
<p>Technically the Linux kernels <em>inode notify</em> subsystem <a href="https://en.wikipedia.org/wiki/Inotify">inotify</a> notifies when the filesystem writes a file in a monitored directory, so we can react relatively fast when there is new or changed file.</p>
<p>So the command line tool or the daemon <em>OpenSemanticSearch-Trigger-Filemonitoring</em> based on the Python library <a href="https://packages.debian.org/stable/python-pyinotify">PyInotify</a> will notice that and will start the crawler (communicating over <a href="../../doc/admin/rest-api">REST-API</a>) to <em><a href="../../connector/files">(re)index the file</a> that is new or was changed</em>.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/opensemanticsearch/open-semantic-search/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
